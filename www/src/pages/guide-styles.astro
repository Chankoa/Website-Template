---
import Layout from "../components/layout/Layout.astro";

const sections = [
  { id: "couleurs", label: "Couleurs & thèmes" },
  { id: "typo", label: "Typographie" },
  { id: "boutons", label: "Boutons" },
  { id: "cards", label: "Cards" },
  { id: "layout", label: "Layout & containers" },
  { id: "utils", label: "Utilitaires" },
  { id: "custom", label: "Personnalisation" },
];
---

<Layout title="Guide des styles" description="Référence rapide du design system, avec exemples et snippets pour personnaliser.">
  <section class="py-16">
    <div class="max-w-6xl mx-auto px-4 grid gap-8 grid-cols-1 md:grid-cols-[260px_minmax(0,1fr)]">
      <aside class="md:sticky md:top-20 md:self-start md:col-start-1 bg-[var(--surface-card)] border border-[var(--border-soft)] rounded-lg p-4 shadow-sm">
        <p class="text-sm font-semibold text-[var(--text-strong)] mb-3">Navigation</p>
        <nav class="flex md:flex-col gap-2 overflow-x-auto pb-1" id="styleguide-nav">
          {sections.map((item) => (
            <a
              href={`#${item.id}`}
              data-target={item.id}
              class="px-3 py-2 whitespace-nowrap rounded-md text-sm text-[var(--text-muted)] hover:text-[var(--text-strong)] hover:bg-[var(--surface-muted)] transition-colors"
            >
              {item.label}
            </a>
          ))}
        </nav>
      </aside>

      <div class="space-y-14 md:col-start-2">
        <header class="space-y-4">
          <p class="text-sm uppercase tracking-[0.08em] text-[var(--text-muted)]">Wiki design</p>
          <h1 class="text-3xl font-bold text-[var(--text-strong)]">Guide des styles</h1>
          <p class="text-[var(--text-muted)] leading-relaxed">
            Ce guide présente les tokens, composants et utilitaires. Chaque bloc inclut un extrait de code pour adapter le thème ou surcharger les styles.
          </p>
          <div class="flex flex-wrap gap-3">
            <a class="btn-primary" href="#custom">Voir la personnalisation</a>
            <span class="badge-pill">Scrollspy actif</span>
          </div>
        </header>

        <section id="couleurs" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Couleurs & thèmes</h2>
          <p class="text-[var(--text-muted)]">Les variables sémantiques sont exposées via le design system. Activez Blue Ocean en ajoutant l’attribut <code>data-theme="blue-ocean"</code> sur <code>&lt;html&gt;</code> ou <code>&lt;body&gt;</code>.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichiers : <code>src/styles/design-system/_semantic-tokens.scss</code> et <code>src/styles/design-system/themes/_blue-ocean.scss</code>.</p>
          <div class="grid sm:grid-cols-2 gap-4">
            <div class="doc-card">
              <p class="text-sm font-semibold mb-2">Activer Blue Ocean</p>
              <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-html"><code class="language-html">{`<body data-theme="blue-ocean">`}</code></pre>
              <p class="text-sm text-[var(--text-muted)] mt-2">Les alias <code>--color-accent</code>, <code>--color-bg</code>, etc. sont mis à jour automatiquement.</p>
            </div>
            <div class="doc-card">
              <p class="text-sm font-semibold mb-2">Changer l’accent primaire</p>
              <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-css"><code class="language-css">{`:root {\n  --accent-primary: #e4572e;\n}`}</code></pre>
              <p class="text-sm text-[var(--text-muted)] mt-2">Ou surchargez dans un thème custom : <code>[data-theme="brand"]</code>.</p>
            </div>
          </div>
        </section>

        <section id="typo" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Typographie</h2>
          <p class="text-[var(--text-muted)]">Police et échelles via <code>--font-body</code> et <code>--font-heading</code>. Ajustez dans <code>_foundations.scss</code> ou surchargez localement.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichier : <code>src/styles/design-system/_foundations.scss</code>.</p>
          <div class="doc-card space-y-3">
            <div class="flex flex-col gap-1">
              <span class="text-sm text-[var(--text-muted)]">Heading</span>
              <h3 class="text-3xl font-bold">Titre H3 — Space Grotesk</h3>
            </div>
            <div class="flex flex-col gap-1">
              <span class="text-sm text-[var(--text-muted)]">Corps</span>
              <p>Texte de paragraphe utilisant <code>--font-body</code> et la couleur <code>--text-default</code>.</p>
            </div>
            <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-css"><code class="language-css">{`:root {\n  --font-heading: "Space Grotesk", system-ui, sans-serif;\n  --font-body: "Inter", system-ui, sans-serif;\n}`}</code></pre>
          </div>
        </section>

        <section id="boutons" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Boutons</h2>
          <p class="text-[var(--text-muted)]">Classe utilitaire <code>.btn-primary</code> (SCSS) basée sur <code>--color-accent</code> et <code>--shadow-soft</code>.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichier : <code>src/styles/components/_buttons.scss</code>.</p>
          <div class="doc-card space-y-3">
            <div class="flex gap-3 items-center flex-wrap">
              <a class="btn-primary" href="#">Appel à l’action</a>
              <a class="btn-primary" href="#" style="--color-accent: #e4572e;">Accent custom inline</a>
            </div>
            <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-css"><code class="language-css">{`.btn-primary {\n  background: var(--color-accent);\n  color: #fff;\n  box-shadow: var(--shadow-soft);\n}`}</code></pre>
          </div>
        </section>

        <section id="cards" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Cards</h2>
          <p class="text-[var(--text-muted)]">Classes <code>.doc-card</code> et <code>.card-elevated</code> pour les blocs de contenu.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichier : <code>src/styles/components/_cards.scss</code>.</p>
          <div class="grid sm:grid-cols-2 gap-4">
            <div class="doc-card">
              <p class="font-semibold text-[var(--text-strong)]">Card par défaut</p>
              <p class="text-[var(--text-muted)]">Fond <code>--surface-card</code>, ombre <code>--shadow-md</code>, rayon <code>--radius-lg</code>.</p>
            </div>
            <div class="card-elevated">
              <p class="font-semibold text-[var(--text-strong)]">Card elevated</p>
              <p class="text-[var(--text-muted)]">Utilise <code>--shadow-soft</code> et <code>--color-bg-alt</code>.</p>
            </div>
          </div>
          <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-css"><code class="language-css">{`.doc-card {\n  background: var(--surface-card);\n  box-shadow: var(--shadow-md);\n}\n.card-elevated {\n  background: var(--color-bg-alt);\n}`}</code></pre>
        </section>

        <section id="layout" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Layout & containers</h2>
          <p class="text-[var(--text-muted)]">Helpers de structure : <code>.app-shell</code>, <code>.main-content</code>, <code>.container</code>.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichiers : <code>src/styles/layout/_base.scss</code> et <code>src/styles/layout/_containers.scss</code>.</p>
          <div class="doc-card space-y-2">
            <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-html"><code class="language-html">{`<div class="app-shell">\n  <main class="main-content">…</main>\n</div>`}</code></pre>
            <p class="text-sm text-[var(--text-muted)]">Utilisez <code>.container</code> pour limiter la largeur : max 1120px.</p>
          </div>
        </section>

        <section id="utils" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Utilitaires</h2>
          <p class="text-[var(--text-muted)]">Helpers rapides pour l’accessibilité et le style.</p>
          <p class="text-xs text-[var(--text-muted)]">Fichier : <code>src/styles/utilities/_helpers.scss</code>.</p>
          <div class="doc-card space-y-2">
            <ul class="list-disc list-inside text-[var(--text-muted)] text-sm space-y-1">
              <li><code>.u-sr-only</code> : texte uniquement pour lecteurs d’écran.</li>
              <li><code>.u-shadow-soft</code> : applique <code>--shadow-soft</code>.</li>
              <li><code>.u-text-muted</code> : couleur <code>--text-muted</code>.</li>
              <li><code>.u-border-soft</code> : bordure <code>--border-soft</code>.</li>
            </ul>
            <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-html"><code class="language-html">{`<span class="u-sr-only">Libellé accessible</span>`}</code></pre>
          </div>
        </section>

        <section id="custom" class="scroll-mt-24 space-y-4" data-spy-section>
          <h2 class="text-2xl font-semibold text-[var(--text-strong)]">Personnalisation</h2>
          <p class="text-[var(--text-muted)]">Créez vos propres thèmes en partant des tokens. Exemple d’un thème “brand”.</p>
          <p class="text-xs text-[var(--text-muted)]">Ajoutez votre fichier de thème dans <code>src/styles/design-system/themes/</code> (ex. <code>_brand.scss</code>).</p>
          <div class="doc-card space-y-3">
            <pre class="bg-[var(--surface-muted)] text-[var(--text-strong)] text-xs p-3 rounded-md overflow-auto language-scss"><code class="language-scss">{`@use "../styles/design-system/semantic-tokens" as tokens;\n\n$brand-tokens: (\n  surface-bg: #fef9f5,\n  surface-card: #ffffff,\n  surface-muted: #ffeede,\n  text-strong: #2b1a14,\n  text-default: #3c241c,\n  text-muted: rgba(43,26,20,0.7),\n  border-soft: #f5d7c3,\n  border-strong: #eabf9b,\n  accent-primary: #ff7a59,\n  accent-primary-strong: #e8643f,\n  accent-secondary: #2b1a14,\n  accent-tertiary: #ffd580,\n  status-info: #2cb1bc,\n  status-success: #1fbf90,\n  status-warning: #ffb347,\n  status-danger: #ff5a5f\n);\n\n[data-theme="brand"] {\n  @include tokens.apply-theme($brand-tokens);\n}`}</code></pre>
            <p class="text-sm text-[var(--text-muted)]">Ensuite, appliquez <code>data-theme="brand"</code> sur <code>&lt;body&gt;</code> ou <code>&lt;html&gt;</code>.</p>
          </div>
        </section>
      </div>
    </div>
  </section>
</Layout>

<script is:inline>
  const nav = document.querySelector("#styleguide-nav");
  const links = nav ? Array.from(nav.querySelectorAll("a[data-target]")) : [];
  const sectionsEls = Array.from(document.querySelectorAll("[data-spy-section]"));

  if (nav && links.length && sectionsEls.length) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.getAttribute("id");
            links.forEach((link) => {
              const active = link.dataset.target === id;
              link.classList.toggle("bg-[var(--surface-muted)]", active);
              link.classList.toggle("text-[var(--text-strong)]", active);
              link.classList.toggle("text-[var(--text-muted)]", !active);
              link.classList.toggle("font-semibold", active);
            });
          }
        });
      },
      { rootMargin: "-40% 0px -40% 0px", threshold: 0.1 }
    );

    sectionsEls.forEach((section) => observer.observe(section));
  }

  // Enhance code blocks: add header with language + copy button
  const codeBlocks = Array.from(document.querySelectorAll('pre[class*="language-"]'));
  codeBlocks.forEach((pre) => {
    const langMatch = pre.className.match(/language-([a-z0-9]+)/i);
    const lang = langMatch ? langMatch[1] : "code";
    const wrapper = document.createElement("div");
    wrapper.className = "code-block";
    wrapper.classList.add(`code-block--${lang.toLowerCase()}`);

    const header = document.createElement("div");
    header.className = "code-block__header";
    const label = document.createElement("span");
    label.className = "code-block__lang";
    label.textContent = lang.toUpperCase();
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "code-block__copy";
    btn.setAttribute("aria-label", "Copier le code");
    btn.textContent = "Copier";

    header.appendChild(label);
    header.appendChild(btn);

    const parent = pre.parentElement;
    parent.replaceChild(wrapper, pre);
    wrapper.appendChild(header);
    wrapper.appendChild(pre);

    btn.addEventListener("click", async () => {
      const codeEl = pre.querySelector("code") || pre;
      const text = codeEl.innerText;
      try {
        await navigator.clipboard.writeText(text);
        btn.textContent = "Copié !";
        btn.classList.add("is-success");
        setTimeout(() => {
          btn.textContent = "Copier";
          btn.classList.remove("is-success");
        }, 1600);
      } catch (e) {
        btn.textContent = "Erreur";
        btn.classList.add("is-error");
        setTimeout(() => {
          btn.textContent = "Copier";
          btn.classList.remove("is-error");
        }, 1600);
      }
    });
  });
</script>

<style is:global>
  /* Prism dark theme (VS Code-like) */
  pre[class*="language-"], code[class*="language-"] {
    background: #0f172a;
    color: #e5e7eb;
    font-family: "JetBrains Mono", SFMono-Regular, Consolas, "Liberation Mono", monospace;
    font-size: 0.82rem;
    line-height: 1.5;
  }
  pre[class*="language-"] {
    padding: calc(var(--space-3) * 1.2) var(--space-4);
    border-radius: 0 0 0.75rem 0.75rem;
    overflow: auto;
    border: 1px solid rgba(148, 163, 184, 0.25);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
  }
  code[class*="language-"] {
    background: transparent;
  }
  /* Inline code minimal chips */
  code:not([class*="language-"]) {
    background: rgba(15, 23, 42, 0.08);
    color: var(--text-strong);
    padding: calc(var(--space-1) * 0.6) calc(var(--space-2) * 0.7);
    border-radius: 0.35rem;
    font-size: 0.85em;
    border: 1px solid rgba(148, 163, 184, 0.35);
  }

  /* Dark mode boost: deeper blacks for code blocks while keeping syntax contrast */
  :root[data-theme="dark"] pre[class*="language-"] {
    background: #05060a;
    border-color: rgba(255, 255, 255, 0.08);
    box-shadow: 0 14px 35px rgba(0, 0, 0, 0.35);
  }
  :root[data-theme="dark"] code[class*="language-"] {
    color: #f3f4f6;
  }
  :root[data-theme="dark"] code:not([class*="language-"]) {
    background: rgba(255, 255, 255, 0.06);
    color: #e5e7eb;
    border-color: rgba(255, 255, 255, 0.1);
  }
  .token.comment { color: #6b7280; }
  .token.punctuation { color: #9ca3af; }
  .token.property, .token.tag, .token.boolean, .token.number { color: #7dd3fc; }
  .token.selector, .token.attr-name, .token.string { color: #a7f3d0; }
  .token.keyword, .token.rule { color: #f59e0b; }
  .token.function, .token.class-name { color: #c7d2fe; }
  .token.operator { color: #fca5a5; }

  /* Code block chrome */
  .code-block {
    background: var(--surface-card);
    border: 1px solid var(--border-soft);
    border-radius: 0.9rem;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.06);
    overflow: hidden;
  }
  .code-block__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
    padding: var(--space-2) calc(var(--space-3) * 1.13);
    background: var(--surface-muted);
    border-bottom: 1px solid var(--border-soft);
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
  }
  .code-block__lang {
    font-weight: 700;
  }
  .code-block__copy {
    border: 1px solid var(--border-soft);
    background: var(--surface-card);
    color: var(--text-strong);
    font-weight: 600;
    font-size: 0.75rem;
    padding: calc(var(--space-1) * 1.2) calc(var(--space-3) * 0.93);
    border-radius: 999px;
    transition: all 0.18s var(--ease-standard);
    cursor: pointer;
  }
  .code-block__copy:hover {
    background: var(--surface-muted);
  }
  .code-block__copy.is-success {
    color: #16a34a;
    border-color: rgba(22, 163, 74, 0.35);
    background: rgba(22, 163, 74, 0.08);
  }
  .code-block__copy.is-error {
    color: #e11d48;
    border-color: rgba(225, 29, 72, 0.35);
    background: rgba(225, 29, 72, 0.08);
  }

  /* Language accents */
  .code-block--html .code-block__lang { color: #f97316; }
  .code-block--css .code-block__lang { color: #3b82f6; }
  .code-block--scss .code-block__lang { color: #ec4899; }
  .code-block--js .code-block__lang { color: #eab308; }
  .code-block--ts .code-block__lang { color: #38bdf8; }
  .code-block--json .code-block__lang { color: #22c55e; }

  /* Dark mode chrome */
  :root[data-theme="dark"] .code-block {
    background: #0b1321;
    border-color: rgba(255, 255, 255, 0.06);
    box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
  }
  :root[data-theme="dark"] .code-block__header {
    background: #0f172a;
    border-color: rgba(255, 255, 255, 0.08);
    color: #cbd5e1;
  }
  :root[data-theme="dark"] .code-block__copy {
    background: #111c30;
    color: #e5e7eb;
    border-color: rgba(255, 255, 255, 0.08);
  }
  :root[data-theme="dark"] .code-block__copy:hover {
    background: #17233a;
  }
  :root[data-theme="dark"] .code-block__copy.is-success {
    color: #4ade80;
    border-color: rgba(74, 222, 128, 0.35);
    background: rgba(74, 222, 128, 0.1);
  }
  :root[data-theme="dark"] .code-block__copy.is-error {
    color: #f43f5e;
    border-color: rgba(244, 63, 94, 0.35);
    background: rgba(244, 63, 94, 0.1);
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markup.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-css.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-scss.min.js" defer></script>
